<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Configurador Studio Insulfilm</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        moss: '#4F6F52',       /* Verde Musgo */
                        mossDark: '#3A523C',
                        black: '#111111',
                        surface: '#1A1A1A',
                    },
                    fontFamily: { sans: ['"Inter"', 'sans-serif'] },
                    boxShadow: { 
                        'dock': '0 -10px 40px -10px rgba(0,0,0,0.1)',
                        'modal': '0 25px 50px -12px rgba(0, 0, 0, 0.25)' 
                    }
                }
            }
        }
    </script>
    
    <style>
        body { 
            transition: background-color 0.5s ease;
            overflow-x: hidden;
        }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        model-viewer {
            width: 100%; height: 100%;
            --poster-color: transparent;
            background-color: transparent;
            outline: none;
        }
        
        /* Anima√ß√µes UI */
        .tint-btn { transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); }
        .tint-btn:active { transform: scale(0.95); }

        /* Card de Sele√ß√£o no Modal */
        .select-card {
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }
        .select-card:hover { transform: translateY(-2px); }
        .select-card.selected {
            border-color: #4F6F52;
            background-color: rgba(79, 111, 82, 0.05);
        }
        .dark .select-card.selected {
            background-color: rgba(79, 111, 82, 0.2);
        }
        
        /* Tema Escuro */
        body.dark { background-color: #0f0f0f; color: white; }
        body.dark footer { background-color: rgba(20, 20, 20, 0.85); border-top-color: rgba(255,255,255,0.1); }

        footer { padding-bottom: env(safe-area-inset-bottom); }

        /* Fade In Modal */
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .modal-animate { animation: fadeIn 0.3s ease-out forwards; }
    </style>
</head>


<body class="bg-white text-black font-sans selection:bg-moss selection:text-white relative transition-colors duration-500 overflow-y-auto">

    <div id="promo-toast" class="fixed top-4 left-4 right-4 md:left-1/2 md:-translate-x-1/2 md:w-auto md:right-auto z-50 flex items-center gap-3 bg-white dark:bg-[#1A1A1A] border border-green-200 dark:border-green-900 shadow-2xl p-4 rounded-2xl transform -translate-y-[200%] transition-transform duration-700 ease-out">
    
        <div class="bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 p-2.5 rounded-full flex-shrink-0 animate-bounce">
            <i class="ph-fill ph-seal-warning text-xl"></i>
        </div>

        <div class="flex-grow">
            <h6 class="font-bold text-sm text-black dark:text-white leading-tight">Ganhe 5% de Desconto!</h6>
            <p class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">V√°lido apenas para or√ßamentos via site.</p>
        </div>

        <button onclick="closeToast()" class="text-gray-400 hover:text-black dark:hover:text-white p-1 transition-colors">
            <i class="ph-bold ph-x"></i>
        </button>
    </div>

    <header class="fixed top-0 left-0 w-full p-6 z-40 flex justify-between items-start pointer-events-none">
        <div class="pointer-events-auto">
            <img src="imgs/logo.png" 
                 alt="Logo Loja" 
                 class="h-24 md:h-36 w-auto z-2 object-contain transition-all duration-500 brightness-0 dark:brightness-100 drop-shadow-sm">
        </div>

        <button id="toggle-night" class="pointer-events-auto w-10 h-10 rounded-full bg-white/20 backdrop-blur-md border border-gray-200 dark:border-gray-700 flex items-center justify-center shadow-lg transition-all hover:scale-110 group">
            <i class="ph-fill ph-moon text-xl text-gray-600 dark:text-yellow-300 group-hover:text-moss dark:group-hover:text-yellow-300 transition-colors" id="night-icon"></i>
        </button>
    </header>

    <section class="h-[100dvh] w-full relative">
        <div class="absolute inset-0 z-0 bg-gradient-to-b from-transparent to-black/5 dark:to-black/40 pointer-events-none"></div>
        
        <div class="relative w-full h-full pb-48 md:pb-32 transition-all duration-300">
    
    <div id="loading-overlay" class="absolute inset-0 z-10 flex flex-col items-center justify-center bg-white/30 dark:bg-black/30 backdrop-blur-md transition-opacity duration-700 pointer-events-none">
            <div class="w-16 h-16 border-4 border-gray-300/50 border-t-moss rounded-full animate-spin mb-4"></div>
            <span class="text-xs font-bold text-moss tracking-widest uppercase animate-pulse">Carregando 3D...</span>
        </div>
        <model-viewer 
            id="car-viewer"
            src="models/fusca.glb" 
            camera-controls 
            shadow-intensity="1.2" 
            shadow-softness="0.8"
            exposure="1"
            tone-mapping="commerce"
            environment-image="env/studio.hdr" 
            alt="Ve√≠culo 3D"
            interaction-prompt="none"
            min-camera-orbit="auto auto auto"
            max-camera-orbit="auto auto auto"
            camera-orbit="45deg 75deg 105%">
        </model-viewer>
    </div>

        <footer class="absolute bottom-0 w-full z-20 bg-white/85 backdrop-blur-xl border-t border-gray-200 pt-4 px-4 md:px-12 flex flex-col gap-4 shadow-dock transition-colors duration-500 pb-[calc(2rem+env(safe-area-inset-bottom))]">
            
            <button onclick="openModal()" class="absolute -top-12 right-4 md:right-12 bg-black dark:bg-white dark:text-black text-white pl-6 pr-4 py-3 rounded-full font-bold text-sm shadow-xl hover:bg-moss dark:hover:bg-moss dark:hover:text-white transition-all flex items-center gap-3 group z-30 transform hover:-translate-y-1">
                <span>OR√áAMENTO</span>
                <div class="bg-white/20 dark:bg-black/10 rounded-full p-1 group-hover:bg-white/30 transition-colors">
                    <i class="ph-bold ph-currency-dollar text-lg"></i>
                </div>
            </button>

            <div class="flex justify-center w-full mb-1">
                <div class="bg-gray-100 dark:bg-gray-800 p-1 rounded-full flex gap-1 shadow-inner">
                    <button onclick="setTargetZone('sides')" id="tab-sides" class="px-6 py-2 rounded-full text-xs font-bold uppercase tracking-wide transition-all bg-white text-black shadow-sm ring-1 ring-black/5">
                        Laterais & Traseira
                    </button>
                    <button onclick="setTargetZone('front')" id="tab-front" class="px-6 py-2 rounded-full text-xs font-bold uppercase tracking-wide transition-all text-gray-500 dark:text-gray-400 hover:text-black dark:hover:text-white">
                        Parabrisa
                    </button>
                </div>
            </div>

            <div class="w-full">
                <div class="flex justify-between items-center px-2 mb-2">
                    <span class="text-[10px] font-bold text-gray-400 uppercase tracking-widest" id="zone-title">Visualizando: Laterais</span>
                    <span id="film-label" class="text-[10px] font-bold text-moss uppercase tracking-widest">G20</span>
                </div>

                <div class="flex gap-3 overflow-x-auto no-scrollbar py-2 px-1 snap-x" id="tints-container">
                    </div>
                
                <div class="text-center mt-2">
                    <span class="text-[10px] text-gray-400 animate-pulse">Role para baixo para ver detalhes das marcas ‚ñº</span>
                </div>
            </div>
        </footer>
    </section>

    <section class="relative z-50 bg-white dark:bg-[#111111] py-20 px-6 md:px-20 transition-colors duration-500">
        <div class="max-w-4xl mx-auto">
            <h2 class="text-3xl font-bold mb-8 text-center text-moss dark:text-white">Nossas Marcas Exclusivas</h2>
            
            <div class="mb-16 grid md:grid-cols-2 gap-8 items-center">
                <div class="order-2 md:order-1">
                    <h3 class="text-2xl font-bold mb-4 dark:text-white">BlueTech</h3>
                    <p class="text-gray-600 dark:text-gray-400 mb-4 leading-relaxed">
                        A escolha inteligente para quem busca performance e est√©tica. A linha BlueTech oferece excelente custo-benef√≠cio com duas varia√ß√µes principais:
                    </p>
                    <ul class="space-y-3">
                        <li class="flex items-start gap-2">
                            <i class="ph-fill ph-shield-check text-moss mt-1"></i>
                            <div>
                                <strong class="block text-black dark:text-gray-200">Carbono (M√©dia Reten√ß√£o)</strong>
                                <span class="text-sm text-gray-500">Estabilidade de cor e √≥tima privacidade. Ideal para o dia a dia.</span>
                            </div>
                        </li>
                        <li class="flex items-start gap-2">
                            <i class="ph-fill ph-star text-moss mt-1"></i>
                            <div>
                                <strong class="block text-black dark:text-gray-200">Cer√¢mico (Alta Reten√ß√£o)</strong>
                                <span class="text-sm text-gray-500">Tecnologia WindowBlue. Maior rejei√ß√£o de calor e clareza √≥ptica superior.</span>
                            </div>
                        </li>
                    </ul>
                </div>
                <div class="order-1 md:order-2 h-64 rounded-2xl overflow-hidden shadow-lg group">
                <img src="imgs/bluetech.png" 
                        alt="Pel√≠cula BlueTech" 
                        class="w-full h-full object-cover transform group-hover:scale-105 transition-transform duration-700">
                </div>
            </div>

            <hr class="border-gray-200 dark:border-gray-800 mb-16">

            <div class="grid md:grid-cols-2 gap-8 items-center">
                <div class="h-64 rounded-2xl overflow-hidden shadow-lg group">
                    <img src="imgs/garware.png" 
                        alt="Pel√≠cula Garware" 
                        class="w-full object-cover transform group-hover:scale-105 mt-9 duration-700">
                </div>
                <div>
                    <h3 class="text-2xl font-bold mb-4 dark:text-white">Garware</h3>
                    <p class="text-gray-600 dark:text-gray-400 mb-4 leading-relaxed">
                        L√≠der global em pel√≠culas de alta performance. Durabilidade extrema e tecnologia de ponta para os clientes mais exigentes.
                    </p>
                    <ul class="space-y-3">
                        <li class="flex items-start gap-2">
                            <i class="ph-fill ph-fire text-moss mt-1"></i>
                            <div>
                                <strong class="block text-black dark:text-gray-200">Linha HP (High Performance)</strong>
                                <span class="text-sm text-gray-500">Estrutura metalizada h√≠brida, oferecendo durabilidade e alta rejei√ß√£o de calor.</span>
                            </div>
                        </li>
                        <li class="flex items-start gap-2">
                            <i class="ph-fill ph-diamond text-moss mt-1"></i>
                            <div>
                                <strong class="block text-black dark:text-gray-200">Linha IR Plus (Infrared)</strong>
                                <span class="text-sm text-gray-500">O topo de linha. Tecnologia de nano-cer√¢mica que bloqueia quase todo o infravermelho sem escurecer a vis√£o interna.</span>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </section>

    <div id="budget-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeModal()"></div>
        
        <div class="relative bg-white dark:bg-gray-900 w-full max-w-lg rounded-3xl shadow-modal overflow-hidden flex flex-col max-h-[90vh]">
            
            <div class="p-6 border-b border-gray-100 dark:border-gray-800 flex justify-between items-center bg-gray-50 dark:bg-gray-800/50">
                <div>
                    <h3 class="text-lg font-bold dark:text-white">Configure seu Pacote</h3>
                    <p class="text-xs text-gray-500 dark:text-gray-400">Personalize para ver o valor final</p>
                </div>
                <button onclick="closeModal()" class="w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                    <i class="ph-bold ph-x text-gray-600 dark:text-white"></i>
                </button>
            </div>

            <div class="p-6 overflow-y-auto no-scrollbar">
                
                <div id="step-1" class="modal-step">
                    <h4 class="text-sm font-bold text-moss uppercase tracking-wide mb-4">Passo 1/2: Laterais e Traseiro</h4>
                    <div class="space-y-3" id="options-sides">
                        </div>
                </div>

                <div id="step-2" class="modal-step hidden">
                    <button onclick="changeStep(1)" class="text-xs text-gray-400 mb-2 flex items-center gap-1 hover:text-black dark:hover:text-white"><i class="ph ph-arrow-left"></i> Voltar</button>
                    <h4 class="text-sm font-bold text-moss uppercase tracking-wide mb-4">Passo 2/2: Parabrisa (Opcional)</h4>
                    <div class="space-y-3" id="options-front">
                        </div>
                </div>

                <div id="step-3" class="modal-step hidden">
                     <button onclick="changeStep(2)" class="text-xs text-gray-400 mb-2 flex items-center gap-1 hover:text-black dark:hover:text-white"><i class="ph ph-arrow-left"></i> Voltar</button>
                    <h4 class="text-sm font-bold text-moss uppercase tracking-wide mb-4">Seus Dados</h4>
                    
                    <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-xl mb-6 border border-gray-100 dark:border-gray-700">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm text-gray-600 dark:text-gray-300">Laterais:</span>
                            <span class="text-sm font-bold dark:text-white" id="summary-sides">-</span>
                        </div>
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm text-gray-600 dark:text-gray-300">Parabrisa:</span>
                            <span class="text-sm font-bold dark:text-white" id="summary-front">-</span>
                        </div>
                        <div class="border-t border-gray-200 dark:border-gray-600 my-2 pt-2 flex justify-between items-center">
                            <span class="text-base font-bold text-black dark:text-white">Total Estimado:</span>
                            <span class="text-xl font-bold text-moss" id="summary-total">R$ 0</span>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <div>
                            <label class="block text-xs font-bold text-gray-500 mb-1">Seu Nome</label>
                            <input type="text" id="client-name" class="w-full bg-gray-100 dark:bg-gray-800 border-none rounded-lg px-4 py-3 text-sm focus:ring-2 focus:ring-moss dark:text-white" placeholder="Como podemos te chamar?">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-500 mb-1">Seu Email</label>
                            <input type="email" id="client-email" class="w-full bg-gray-100 dark:bg-gray-800 border-none rounded-lg px-4 py-3 text-sm focus:ring-2 focus:ring-moss dark:text-white" placeholder="seu@email.com">
                        </div>
                    </div>
                </div>

            </div>

            <div class="p-6 border-t border-gray-100 dark:border-gray-800 bg-gray-50 dark:bg-gray-800/50">
                <div class="flex justify-between items-center">
                    <div class="flex flex-col">
                        <span class="text-[10px] text-gray-500 uppercase tracking-wider flex items-center gap-1">
                            Valor Total 
                            <span class="bg-green-100 text-green-700 text-[9px] px-1.5 rounded font-bold">5% OFF</span>
                        </span>
                        <span class="text-2xl font-bold text-moss" id="live-total">R$ 0</span>
                    </div>
                    <button id="next-btn" onclick="nextStep()" class="bg-black dark:bg-white text-white dark:text-black px-8 py-3 rounded-full font-bold text-sm shadow-lg hover:scale-105 transition-transform flex items-center gap-2">
                        <span>Pr√≥ximo</span>
                        <i class="ph-bold ph-arrow-right"></i>
                    </button>
                    <button id="finish-btn" onclick="sendToWhatsapp()" class="hidden bg-[#25D366] text-white px-6 py-3 rounded-full font-bold text-sm shadow-lg hover:scale-105 transition-transform flex items-center gap-2">
                        <span>Contratar no WhatsApp</span>
                        <i class="ph-bold ph-whatsapp-logo text-lg"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        
        // ================= L√ìGICA DO TOAST =================

        // Fun√ß√£o para mostrar o toast
        function showToast() {
            const toast = document.getElementById('promo-toast');
            // Remove a classe que joga ele pra fora da tela (-translate-y-[200%])
            toast.classList.remove('-translate-y-[200%]');
        }

        // Fun√ß√£o para fechar o toast
        function closeToast() {
            const toast = document.getElementById('promo-toast');
            // Joga ele pra cima de novo
            toast.classList.add('-translate-y-[200%]');
        }

        // Ativa o toast automaticamente ap√≥s 1.5 segundos que a p√°gina carregar
        window.addEventListener('load', () => {
            setTimeout(showToast, 1500);
        });
        // Fun√ß√£o auxiliar para formatar dinheiro (BRL)
        const formatMoney = (value) => {
            return value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        };
        // ================= DADOS DE PRE√áOS =================
        const pricingData = {
            sides: [
                { id: 'bt_carb', brand: 'BlueTech', name: 'Carbono (M√©dia Reten√ß√£o)', price: 599, desc: 'Privacidade e custo-benef√≠cio.' },
                { id: 'bt_cer',  brand: 'BlueTech', name: 'Cer√¢mico (Alta Reten√ß√£o)', price: 799, desc: 'Tecnologia WindowBlue t√©rmica.' },
                { id: 'gw_hp',   brand: 'Garware',  name: 'HP (High Perf.)', price: 899, desc: 'Metalizada h√≠brida.' },
                { id: 'gw_ir',   brand: 'Garware',  name: 'IR Plus (Top)',   price: 1499, desc: 'M√°xima rejei√ß√£o de calor.' }
            ],
            front: [
                { id: 'none',    brand: '-',        name: 'Sem Pel√≠cula',    price: 0,   desc: 'Manter vidro original.' },
                { id: 'bt_carb', brand: 'BlueTech', name: 'Carbono',         price: 279, desc: 'Prote√ß√£o b√°sica UV.' },
                { id: 'bt_cer',  brand: 'BlueTech', name: 'Cer√¢mico',        price: 389, desc: 'Alta visibilidade noturna.' },
                { id: 'gw_hp',   brand: 'Garware',  name: 'HP',              price: 499, desc: 'Conforto t√©rmico.' },
                { id: 'gw_ir',   brand: 'Garware',  name: 'IR Plus',         price: 749, desc: 'Premium nano-cer√¢mica.' }
            ]
        };

        // Estado do Or√ßamento
        let budgetState = {
            step: 1,
            sides: pricingData.sides[0], // Padr√£o
            front: pricingData.front[0]  // Padr√£o
        };

        // ================= L√ìGICA DO MODAL =================

        function openModal() {
            document.getElementById('budget-modal').classList.remove('hidden');
            renderBudgetOptions();
            updateBudgetUI();
        }

        function closeModal() {
            document.getElementById('budget-modal').classList.add('hidden');
            budgetState.step = 1;
            changeStep(1); // Resetar para o inicio
        }

        function renderBudgetOptions() {
            // Renderizar Laterais
            const sidesContainer = document.getElementById('options-sides');
            sidesContainer.innerHTML = pricingData.sides.map(opt => `
                <div onclick="selectBudgetOption('sides', '${opt.id}')" 
                     class="select-card cursor-pointer p-4 rounded-xl bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 relative group ${budgetState.sides.id === opt.id ? 'selected' : ''}">
                    <div class="flex justify-between items-start">
                        <div>
                            <span class="text-[10px] uppercase font-bold text-gray-400 tracking-wider">${opt.brand}</span>
                            <h5 class="font-bold text-black dark:text-white text-base">${opt.name}</h5>
                            <p class="text-xs text-gray-500 mt-1">${opt.desc}</p>
                        </div>
                        <span class="font-bold text-moss text-lg">R$ ${opt.price}</span>
                    </div>
                    <div class="absolute right-4 top-1/2 -translate-y-1/2 text-moss opacity-0 ${budgetState.sides.id === opt.id ? 'opacity-100' : ''}">
                        <i class="ph-fill ph-check-circle text-2xl"></i>
                    </div>
                </div>
            `).join('');

            // Renderizar Parabrisa
            const frontContainer = document.getElementById('options-front');
            frontContainer.innerHTML = pricingData.front.map(opt => `
                <div onclick="selectBudgetOption('front', '${opt.id}')" 
                     class="select-card cursor-pointer p-4 rounded-xl bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 relative group ${budgetState.front.id === opt.id ? 'selected' : ''}">
                    <div class="flex justify-between items-start">
                        <div>
                            <span class="text-[10px] uppercase font-bold text-gray-400 tracking-wider">${opt.brand}</span>
                            <h5 class="font-bold text-black dark:text-white text-base">${opt.name}</h5>
                            <p class="text-xs text-gray-500 mt-1">${opt.desc}</p>
                        </div>
                        <span class="font-bold text-moss text-lg">${opt.price === 0 ? '--' : 'R$ ' + opt.price}</span>
                    </div>
                    <div class="absolute right-4 top-1/2 -translate-y-1/2 text-moss opacity-0 ${budgetState.front.id === opt.id ? 'opacity-100' : ''}">
                        <i class="ph-fill ph-check-circle text-2xl"></i>
                    </div>
                </div>
            `).join('');
        }

        function selectBudgetOption(type, id) {
            const list = type === 'sides' ? pricingData.sides : pricingData.front;
            budgetState[type] = list.find(item => item.id === id);
            renderBudgetOptions(); // Re-renderizar para atualizar visual de sele√ß√£o
            updateBudgetUI();
        }

        function updateBudgetUI() {
            const rawTotal = budgetState.sides.price + budgetState.front.price;
            const discount = rawTotal * 0.05; // 5% de desconto
            const finalTotal = rawTotal - discount;

            // Atualiza o total no rodap√© (passo 1 e 2)
            const totalHTML = `
                <div class="flex flex-col items-end">
                    <span class="text-xs text-gray-400 line-through decoration-red-500">${formatMoney(rawTotal)}</span>
                    <span class="text-2xl font-bold text-moss">${formatMoney(finalTotal)}</span>
                </div>
            `;
            
            // Atualiza os elementos na tela
            document.getElementById('live-total').innerHTML = totalHTML;
            
            // Atualiza o resumo no Modal (Passo 3)
            document.getElementById('summary-total').innerHTML = `
                <div class="flex flex-col items-end">
                    <span class="text-xs text-gray-400 line-through">${formatMoney(rawTotal)}</span>
                    <span class="text-xl font-bold text-moss">${formatMoney(finalTotal)}</span>
                    <span class="text-[10px] text-green-600 bg-green-100 px-2 py-0.5 rounded-full font-bold">5% OFF Web</span>
                </div>
            `;
            
            // Resumo texto dos itens
            document.getElementById('summary-sides').innerText = `${budgetState.sides.brand} ${budgetState.sides.name}`;
            document.getElementById('summary-front').innerText = `${budgetState.front.brand} ${budgetState.front.name}`;
        }

        function nextStep() {
            if(budgetState.step < 3) {
                changeStep(budgetState.step + 1);
            }
        }

        function changeStep(step) {
            budgetState.step = step;
            
            // Esconder todos
            document.getElementById('step-1').classList.add('hidden');
            document.getElementById('step-2').classList.add('hidden');
            document.getElementById('step-3').classList.add('hidden');
            
            // Mostrar atual
            const currentDiv = document.getElementById(`step-${step}`);
            currentDiv.classList.remove('hidden');
            currentDiv.classList.add('modal-animate');

            // Gerenciar Bot√µes do Footer
            const nextBtn = document.getElementById('next-btn');
            const finishBtn = document.getElementById('finish-btn');

            if (step === 3) {
                nextBtn.classList.add('hidden');
                finishBtn.classList.remove('hidden');
                finishBtn.classList.add('flex');
            } else {
                nextBtn.classList.remove('hidden');
                finishBtn.classList.add('hidden');
                finishBtn.classList.remove('flex');
            }
        }

        function sendToWhatsapp() {
            const name = document.getElementById('client-name').value;
            const email = document.getElementById('client-email').value;

            if(!name) { alert('Por favor, digite seu nome.'); return; }

            const rawTotal = budgetState.sides.price + budgetState.front.price;
            const discount = rawTotal * 0.05;
            const finalTotal = rawTotal - discount;

            // SEU N√öMERO AQUI
            const phone = "5532999734079"; 

            const text = `*NOVO OR√áAMENTO SITE (COM DESCONTO)*\n` +
                        `üë§ Cliente: ${name}\n` +
                        `üìß Email: ${email}\n\n` +
                        `*Configura√ß√£o Escolhida:*\n` +
                        `üöó Laterais/Traseira: ${budgetState.sides.brand} - ${budgetState.sides.name}\n` +
                        `üöô Parabrisa: ${budgetState.front.brand} - ${budgetState.front.name}\n\n` +
                        `üí∞ Subtotal: ${formatMoney(rawTotal)}\n` +
                        `üìâ *Desconto Web (5%): -${formatMoney(discount)}*\n` +
                        `‚úÖ *VALOR FINAL: ${formatMoney(finalTotal)}*`;

            window.open(`https://wa.me/${phone}?text=${encodeURIComponent(text)}`, '_blank');
            closeModal();
        }

        // ================= CONFIGURA√á√ÉO DE MATERIAIS 3D =================
        const materialNames = {
            front: 'glass_front',
            sides: 'glass_side', 
            ignore: 'glass_back' 
        };

        const tintData = {
            'clear': { opacity: 0.1, color: '#ffffff', roughness: 0.1, name: 'Original' },
            'g70':   { opacity: 0.35, color: '#444444', roughness: 0.1, name: 'G70' },
            'g35':   { opacity: 0.55, color: '#2a2a2a', roughness: 0.05, name: 'G35' },
            'g20':   { opacity: 0.82, color: '#111111', roughness: 0.02, name: 'G20' },
            'g5':    { opacity: 0.98, color: '#000000', roughness: 0.01, name: 'G5' },
        };

        let state = {
            activeZone: 'sides',
            currentTints: { sides: 'clear', front: 'clear' },
            isNight: false
        };

        const viewer = document.getElementById('car-viewer');

        // ================= FUN√á√ïES DE ZONA (VISUALIZADOR) =================

        function setTargetZone(zone) {
            state.activeZone = zone;
            
            const btnSides = document.getElementById('tab-sides');
            const btnFront = document.getElementById('tab-front');
            
            const activeClass = "bg-white text-black shadow-sm ring-1 ring-black/5 dark:bg-gray-600 dark:text-white dark:ring-0";
            const inactiveClass = "text-gray-500 hover:text-black dark:text-gray-400 dark:hover:text-white";

            if (zone === 'sides') {
                btnSides.className = `px-6 py-2 rounded-full text-xs font-bold uppercase tracking-wide transition-all ${activeClass}`;
                btnFront.className = `px-6 py-2 rounded-full text-xs font-bold uppercase tracking-wide transition-all ${inactiveClass}`;
                document.getElementById('zone-title').innerText = "Visualizando: Laterais & Traseira";
            } else {
                btnFront.className = `px-6 py-2 rounded-full text-xs font-bold uppercase tracking-wide transition-all ${activeClass}`;
                btnSides.className = `px-6 py-2 rounded-full text-xs font-bold uppercase tracking-wide transition-all ${inactiveClass}`;
                document.getElementById('zone-title').innerText = "Visualizando: Parabrisa";
            }

            updateTintButtonsUI();
            
            // Mantendo o zoom afastado (145%) nas transi√ß√µes
            if(zone === 'front') {
                viewer.cameraOrbit = '0deg 75deg 145%'; 
            } else {
                viewer.cameraOrbit = '45deg 75deg 145%';
            }
        }

        function setTint(tintId) {
            state.currentTints[state.activeZone] = tintId;
            updateTintButtonsUI();
            applyTintToModel();
        }

        // ================= L√ìGICA 3D =================

        function applyTintToModel() {
            if (!viewer.model) return;

            const getParams = (id) => {
                const d = tintData[id];
                let c = d.color.substring(1).split('');
                if(c.length===3) c= [c[0], c[0], c[1], c[1], c[2], c[2]];
                c= '0x'+c.join('');
                const rgb = [((c>>16)&255)/255, ((c>>8)&255)/255, (c&255)/255];
                return { rgb, ...d };
            };

            const sidesParams = getParams(state.currentTints.sides);
            const frontParams = getParams(state.currentTints.front);

            viewer.model.materials.forEach(mat => {
                const name = mat.name.toLowerCase();

                if (name.includes(materialNames.ignore)) return; 

                if (name.includes(materialNames.front)) {
                    applyMaterial(mat, frontParams);
                } 
                else if (name.includes(materialNames.sides)) {
                    applyMaterial(mat, sidesParams);
                }
            });
        }

        function applyMaterial(mat, p) {
            mat.pbrMetallicRoughness.setRoughnessFactor(p.roughness);
            mat.pbrMetallicRoughness.setMetallicFactor(0.95);
            mat.pbrMetallicRoughness.setBaseColorFactor([...p.rgb, p.opacity]);
            mat.setAlphaMode('BLEND');
            mat.setDoubleSided(true);
        }

        // ================= UI BUILDER (VISUALIZADOR) =================

        function renderTintButtons() {
            const container = document.getElementById('tints-container');
            container.innerHTML = '';

            Object.keys(tintData).forEach(key => {
                const t = tintData[key];
                const btn = document.createElement('button');
                btn.className = 'tint-btn snap-center flex-shrink-0 group cursor-pointer text-center min-w-[60px]';
                btn.onclick = () => setTint(key);
                btn.dataset.id = key;

                let innerContent = '', bgStyle = '';
                
                if (key === 'clear') {
                    innerContent = '<i class="ph ph-sun text-gray-400 text-lg"></i>';
                    bgStyle = 'bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600';
                } else {
                    if(key === 'g70') bgStyle = 'bg-[#aaaaaa] border-gray-300';
                    if(key === 'g35') bgStyle = 'bg-[#555555] border-gray-400';
                    if(key === 'g20') bgStyle = 'bg-[#222222] border-gray-500';
                    if(key === 'g5')  bgStyle = 'bg-[#000000] border-gray-600';
                }

                btn.innerHTML = `
                    <div class="tint-circle w-12 h-12 rounded-full border transition-all relative overflow-hidden mx-auto mb-2 shadow-sm flex items-center justify-center ${bgStyle}">
                        ${innerContent}
                    </div>
                    <span class="tint-text text-[9px] font-bold text-gray-400 uppercase group-hover:text-black dark:group-hover:text-white block">${t.name.split(' ')[0]}</span>
                `;
                container.appendChild(btn);
            });
        }

        function updateTintButtonsUI() {
            const currentId = state.currentTints[state.activeZone];
            document.getElementById('film-label').innerText = tintData[currentId].name;

            document.querySelectorAll('.tint-btn').forEach(btn => {
                const circle = btn.querySelector('.tint-circle');
                const text = btn.querySelector('.tint-text');
                const isSelected = btn.dataset.id === currentId;

                if (isSelected) {
                    circle.classList.add('ring-2', 'ring-moss', 'ring-offset-2', 'dark:ring-offset-gray-900', 'border-transparent');
                    circle.classList.remove('border-gray-300', 'border-gray-400', 'border-gray-500', 'border-gray-600');
                    text.classList.remove('text-gray-400');
                    text.classList.add('text-black', 'dark:text-white');
                } else {
                    circle.classList.remove('ring-2', 'ring-moss', 'ring-offset-2', 'dark:ring-offset-gray-900', 'border-transparent');
                    if(!circle.className.includes('border-')) circle.classList.add('border-gray-300');
                    text.classList.add('text-gray-400');
                    text.classList.remove('text-black', 'dark:text-white');
                }
            });
        }

        // ================= NIGHT MODE & INIT =================

        document.getElementById('toggle-night').addEventListener('click', () => {
            state.isNight = !state.isNight;
            const body = document.body;
            const icon = document.getElementById('night-icon');
            
            if (state.isNight) {
                body.classList.add('dark');
                icon.classList.replace('ph-moon', 'ph-sun');
                viewer.environmentImage = 'env/night.hdr'; 
                viewer.exposure = 0.7;
            } else {
                body.classList.remove('dark');
                icon.classList.replace('ph-sun', 'ph-moon');
                viewer.environmentImage = 'env/studio.hdr';
                viewer.exposure = 1;
            }
        });

        renderTintButtons();
        setTargetZone('sides');
        viewer.addEventListener('load', applyTintToModel);

        // ================= NIGHT MODE & LOADER REATIVO =================

        const loader = document.getElementById('loading-overlay');
        const nightBtn = document.getElementById('toggle-night');

        // Fun√ß√£o auxiliar para mostrar/esconder loader
        function toggleLoader(show) {
            if (show) {
                loader.classList.remove('opacity-0');
            } else {
                // Pequeno delay est√©tico para a transi√ß√£o ser suave
                setTimeout(() => {
                    loader.classList.add('opacity-0');
                }, 500);
            }
        }

        // 1. L√≥gica do Bot√£o (Mostra o loader -> Troca o tema)
        nightBtn.addEventListener('click', () => {
            // Mostra o loader imediatamente
            toggleLoader(true);

            // Um pequeno timeout para dar tempo do navegador renderizar o loader
            // antes de travar o processo trocando o HDR pesado
            setTimeout(() => {
                state.isNight = !state.isNight;
                const body = document.body;
                const icon = document.getElementById('night-icon');
                
                if (state.isNight) {
                    body.classList.add('dark');
                    icon.classList.replace('ph-moon', 'ph-sun');
                    viewer.environmentImage = 'env/night.hdr'; 
                    viewer.exposure = 0.7;
                } else {
                    body.classList.remove('dark');
                    icon.classList.replace('ph-sun', 'ph-moon');
                    viewer.environmentImage = 'env/studio.hdr';
                    viewer.exposure = 1;
                }
            }, 100);
        });

        // 2. Quando o 3D terminar de carregar (inicial)
        viewer.addEventListener('load', () => {
            applyTintToModel();
            toggleLoader(false);
        });

        // 3. Quando a ilumina√ß√£o (Environment) terminar de trocar
        viewer.addEventListener('environment-change', () => {
            toggleLoader(false);
        });

        // Fallback de seguran√ßa (caso o evento falhe ou demore demais)
        setTimeout(() => toggleLoader(false), 8000);

        // Inicializa√ß√£o
        renderTintButtons();
        setTargetZone('sides');

    </script>
</body>
</html>