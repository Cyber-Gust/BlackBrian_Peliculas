<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel do Blog - Black Brian</title>
    
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: { 400: "#6f9f6a", 500: "#4e7f49", 600: "#3d6538" },
                        dark: { 800: "#18181b", 900: "#09090b" }
                    },
                    fontFamily: { sans: ['Inter', 'sans-serif'] }
                }
            }
        }
    </script>
    <style>
        body { background-color: #f4f4f5; font-family: 'Inter', sans-serif; }
        /* Ajuste para o editor ficar com fundo branco e altura boa */
        .ql-container { height: 300px; background: white; border-bottom-left-radius: 0.5rem; border-bottom-right-radius: 0.5rem; }
        .ql-toolbar { background: white; border-top-left-radius: 0.5rem; border-top-right-radius: 0.5rem; }
    </style>
</head>
<body class="bg-zinc-100 pb-20">

    <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-3xl mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <img src="imgs/LOGO.png" class="h-10 bg-black p-1 rounded">
                <h1 class="font-bold text-zinc-700">Editor de Blog</h1>
            </div>
            <a href="/blog/index.html" target="_blank" class="text-sm text-brand-600 font-bold hover:underline">Ver Blog</a>
        </div>
    </header>

    <main class="max-w-3xl mx-auto px-6 mt-10">
        <form id="postForm" class="space-y-6">
            
            <div>
                <label class="block text-xs font-bold text-zinc-500 uppercase mb-1">Título da Postagem</label>
                <input type="text" id="titulo" required onkeyup="gerarSlug()"
                    class="w-full bg-white border border-zinc-300 rounded-lg p-3 font-bold text-zinc-800 focus:ring-2 focus:ring-brand-500 outline-none">
            </div>

            <div>
                <label class="block text-xs font-bold text-zinc-500 uppercase mb-1">Slug (Link Amigável)</label>
                <input type="text" id="slug" readonly
                    class="w-full bg-zinc-200 border border-zinc-300 rounded-lg p-2 text-sm text-zinc-600">
            </div>

            <div>
                <label class="block text-xs font-bold text-zinc-500 uppercase mb-1">URL da Imagem de Capa</label>
                <input type="text" id="imagem_capa" placeholder="https://..."
                    class="w-full bg-white border border-zinc-300 rounded-lg p-3 text-zinc-800 focus:ring-2 focus:ring-brand-500 outline-none">
                <p class="text-[10px] text-zinc-400 mt-1">Dica: Use links diretos das suas imagens hospedadas.</p>
            </div>

            <div>
                <label class="block text-xs font-bold text-zinc-500 uppercase mb-1">Resumo (Para o Card)</label>
                <textarea id="resumo" rows="3"
                    class="w-full bg-white border border-zinc-300 rounded-lg p-3 text-zinc-800 focus:ring-2 focus:ring-brand-500 outline-none"></textarea>
            </div>

            <div>
                <label class="block text-xs font-bold text-zinc-500 uppercase mb-1">Conteúdo Completo</label>
                <div id="editor"></div>
            </div>

            <button type="submit" id="btnSalvar"
                class="w-full bg-brand-600 hover:bg-brand-500 text-white font-bold py-4 rounded-xl shadow-lg transition transform active:scale-95">
                PUBLICAR POSTAGEM
            </button>

        </form>
    </main>

    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script>
        // --- CONFIGURAÇÃO SUPABASE (Mesma da Agenda) ---
        const SUPABASE_URL = 'https://vdxliqcozysjgomcfuhs.supabase.co'; 
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZkeGxpcWNvenlzamdvbWNmdWhzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc1NDUwOTUsImV4cCI6MjA4MzEyMTA5NX0.-QUm03qwxrFJuCDQEv276PYLtOJEwEni478GrnMeEPI';
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // --- CONFIGURAÇÃO DO EDITOR QUILL ---
        var quill = new Quill('#editor', {
            theme: 'snow',
            placeholder: 'Escreva seu artigo incrível aqui...',
            modules: {
                toolbar: [
                    [{ 'header': [2, 3, false] }],
                    ['bold', 'italic', 'underline'],
                    [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                    ['link', 'clean']
                ]
            }
        });

        // --- GERADOR DE SLUG ---
        function gerarSlug() {
            const titulo = document.getElementById('titulo').value;
            const slug = titulo.toLowerCase()
                .normalize('NFD').replace(/[\u0300-\u036f]/g, "") // Remove acentos
                .replace(/[^\w\s-]/g, '') // Remove caracteres especiais
                .replace(/\s+/g, '-'); // Troca espaço por hifen
            document.getElementById('slug').value = slug;
        }

        // --- SALVAR NO BANCO ---
        document.getElementById('postForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('btnSalvar');
            btn.innerText = "PUBLICANDO...";
            btn.disabled = true;

            const post = {
                titulo: document.getElementById('titulo').value,
                slug: document.getElementById('slug').value,
                imagem_capa: document.getElementById('imagem_capa').value,
                resumo: document.getElementById('resumo').value,
                conteudo: quill.root.innerHTML // Pega o HTML do editor
            };

            const { error } = await supabaseClient.from('posts').insert([post]);

            if (error) {
                alert('Erro ao publicar: ' + error.message);
                btn.innerText = "TENTAR NOVAMENTE";
            } else {
                alert('Sucesso! Artigo publicado.');
                window.location.reload();
            }
            btn.disabled = false;
        });
    </script>
</body>
</html>