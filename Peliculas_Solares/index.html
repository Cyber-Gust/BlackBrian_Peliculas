<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Configurador Studio Insulfilm</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        moss: '#4F6F52',       /* Verde Musgo */
                        mossDark: '#3A523C',
                        black: '#111111',
                        surface: '#1A1A1A',
                    },
                    fontFamily: { sans: ['"Inter"', 'sans-serif'] },
                    boxShadow: { 
                        'dock': '0 -10px 40px -10px rgba(0,0,0,0.1)',
                        'modal': '0 25px 50px -12px rgba(0, 0, 0, 0.25)' 
                    }
                }
            }
        }
    </script>
    
    <style>
        body { 
            transition: background-color 0.5s ease;
            overflow-x: hidden;
        }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        model-viewer {
            width: 100%; height: 100%;
            --poster-color: transparent;
            background-color: transparent;
            outline: none;
        }
        
        /* Animações UI */
        .tint-btn { transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); }
        .tint-btn:active { transform: scale(0.95); }

        /* Card de Seleção no Modal */
        .select-card {
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }
        .select-card:hover { transform: translateY(-2px); }
        .select-card.selected {
            border-color: #4F6F52;
            background-color: rgba(79, 111, 82, 0.05);
        }
        .dark .select-card.selected {
            background-color: rgba(79, 111, 82, 0.2);
        }
        
        /* Tema Escuro */
        body.dark { background-color: #0f0f0f; color: white; }
        body.dark footer { background-color: rgba(20, 20, 20, 0.85); border-top-color: rgba(255,255,255,0.1); }

        footer { padding-bottom: env(safe-area-inset-bottom); }

        /* Fade In Modal */
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .modal-animate { animation: fadeIn 0.3s ease-out forwards; }
    </style>
</head>


<body class="bg-white text-black font-sans selection:bg-moss selection:text-white relative transition-colors duration-500 overflow-y-auto">

    <div id="promo-toast" class="fixed top-4 left-4 right-4 md:left-1/2 md:-translate-x-1/2 md:w-auto md:right-auto z-50 flex flex-col bg-white dark:bg-[#1A1A1A] border border-green-200 dark:border-green-900 shadow-2xl rounded-2xl transform -translate-y-[200%] transition-transform duration-700 ease-out overflow-hidden">
        
        <div class="flex items-center gap-3 p-4">
            <div class="bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 p-2.5 rounded-full flex-shrink-0 animate-bounce">
                <i class="ph-fill ph-seal-warning text-xl"></i>
            </div>

            <div class="flex-grow">
                <h6 class="font-bold text-sm text-black dark:text-white leading-tight">Ganhe 5% de Desconto!</h6>
                <p class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">Válido apenas para orçamentos via site.</p>
            </div>

            <button onclick="closeToast()" class="text-gray-400 hover:text-black dark:hover:text-white p-1 transition-colors">
                <i class="ph-bold ph-x"></i>
            </button>
        </div>

        <div class="h-1 w-full bg-gray-100 dark:bg-gray-800">
            <div id="toast-progress" class="h-full bg-green-500 w-0"></div>
        </div>
    </div>

    <header class="fixed top-0 left-0 w-full p-6 z-40 flex justify-between items-start pointer-events-none">
    <div class="pointer-events-auto">
        <img src="imgs/logo.png" 
             alt="Logo Loja" 
             class="h-24 md:h-36 w-auto z-2 object-contain transition-all duration-500 brightness-0 dark:brightness-100 drop-shadow-sm">
    </div>

    <button id="toggle-night" class="pointer-events-auto w-10 h-10 rounded-full bg-white/20 backdrop-blur-md border border-gray-200 dark:border-gray-700 flex items-center justify-center shadow-lg transition-all hover:scale-110 group">
        <i class="ph-fill ph-moon text-xl text-gray-600 dark:text-yellow-300 group-hover:text-moss dark:group-hover:text-yellow-300 transition-colors" id="night-icon"></i>
    </button>
    </header>

    <section class="h-[100svh] w-full relative overflow-hidden">
        <div class="absolute inset-0 z-0 bg-gradient-to-b from-transparent to-black/5 dark:to-black/40 pointer-events-none"></div>
        
        <div class="relative w-full h-full pb-40 md:pb-32 transition-all duration-300">
            
            <div id="loading-overlay" class="absolute inset-0 z-10 flex flex-col items-center justify-center bg-white/30 dark:bg-black/30 backdrop-blur-md transition-opacity duration-700 pointer-events-none -translate-y-[15%] md:translate-y-0">
                <div class="w-16 h-16 border-4 border-gray-300/50 border-t-moss rounded-full animate-spin mb-4"></div>
                <span class="text-xs font-bold text-moss tracking-widest uppercase animate-pulse">Carregando 3D...</span>
            </div>

            <model-viewer 
                id="car-viewer"
                class="w-full h-full -translate-y-[10%] md:translate-y-0 transition-transform duration-500" 
                src="models/Jaecoo.glb" 
                camera-controls 
                carColors="['silver']"
                shadow-intensity="1.2" 
                shadow-softness="0.8"
                exposure="1"
                tone-mapping="commerce"
                environment-image="env/studio.hdr" 
                alt="Veículo 3D"
                interaction-prompt="none"
                min-camera-orbit="auto auto auto"
                max-camera-orbit="auto auto auto"
                camera-orbit="45deg 75deg 105%">
            </model-viewer>
        </div>

        <footer class="absolute bottom-0 w-full z-20 bg-white/90 dark:bg-gray-900/90 backdrop-blur-xl border-t border-gray-200 dark:border-gray-800 pt-3 px-3 pb-[calc(1rem+env(safe-area-inset-bottom))] shadow-[0_-10px_40px_rgba(0,0,0,0.1)] rounded-t-3xl md:rounded-none transition-transform duration-500">
            
            <button onclick="openModal()" class="absolute -top-14 right-4 bg-black dark:bg-white dark:text-black text-white px-5 py-3 rounded-full font-bold text-xs shadow-xl hover:bg-moss dark:hover:bg-moss dark:hover:text-white transition-all flex items-center gap-2 group z-30 transform hover:-translate-y-1">
                <span>ORÇAMENTO</span>
                <div class="bg-white/20 dark:bg-black/10 rounded-full p-1 group-hover:bg-white/30 transition-colors">
                    <i class="ph-bold ph-currency-dollar text-sm"></i>
                </div>
            </button>

            <div class="max-w-4xl mx-auto flex flex-col gap-4">
                
                <div class="grid grid-cols-2 gap-3 w-full">

                    <div class="relative" id="model-dropdown-container">
                        <button onclick="toggleModelDropdown()" type="button" class="relative w-full bg-gray-100 dark:bg-gray-800 border-none text-gray-900 dark:text-gray-100 text-xs font-bold rounded-xl py-3 pl-10 pr-8 focus:ring-2 focus:ring-moss transition-all cursor-pointer text-left flex items-center justify-between">
                            
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-500 dark:text-gray-400">
                                <i class="ph-fill ph-car text-lg"></i>
                            </div>

                            <span id="displayModelText" class="truncate">SUV</span>

                            <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none text-gray-500">
                                <i id="modelArrow" class="ph-bold ph-caret-down transition-transform duration-200"></i>
                            </div>
                        </button>

                        <div id="modelOptionsList" class="hidden absolute bottom-full mb-2 left-0 right-0 bg-white dark:bg-gray-900 rounded-xl shadow-xl border border-gray-100 dark:border-gray-700 z-50 overflow-hidden transition-all animate-fade-in-up">
                            <ul class="max-h-60 overflow-y-auto py-1">
                                <li onclick="selectModel('suv', 'SUV')" class="cursor-pointer px-4 py-2.5 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-xs font-bold text-gray-700 dark:text-gray-200">SUV</li>
                                <li onclick="selectModel('sedan', 'Sedã')" class="cursor-pointer px-4 py-2.5 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-xs font-bold text-gray-700 dark:text-gray-200">Sedã</li>
                                <li onclick="selectModel('hatch', 'Hatch')" class="cursor-pointer px-4 py-2.5 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-xs font-bold text-gray-700 dark:text-gray-200">Hatch</li>
                                <li onclick="selectModel('pickup', 'Caminhonete')" class="cursor-pointer px-4 py-2.5 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-xs font-bold text-gray-700 dark:text-gray-200">Caminhonete</li>
                                <li onclick="selectModel('sport', 'Esportivo')" class="cursor-pointer px-4 py-2.5 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-xs font-bold text-gray-700 dark:text-gray-200">Esportivo</li>
                                <li onclick="selectModel('classic', 'Antigo')" class="cursor-pointer px-4 py-2.5 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-xs font-bold text-gray-700 dark:text-gray-200">Antigo</li>
                            </ul>
                        </div>
                    </div>

                    <div class="relative" id="color-dropdown-container">
                        <input type="hidden" id="selectedColorValue" value="silver">

                        <button onclick="toggleColorDropdown()" type="button" class="relative w-full bg-gray-100 dark:bg-gray-800 border-none text-gray-900 dark:text-gray-100 text-xs font-bold rounded-xl py-3 pl-10 pr-8 focus:ring-2 focus:ring-moss transition-all cursor-pointer text-left flex items-center justify-between">
                            
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-500 dark:text-gray-400">
                                <i class="ph-fill ph-paint-bucket text-lg"></i>
                            </div>

                            <span id="displayColorText" class="flex items-center gap-2 truncate">
                                <span id="displayColorDot" class="w-3 h-3 rounded bg-gray-400 border border-gray-300"></span>
                                Prata
                            </span>

                            <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none text-gray-500">
                                <i id="colorArrow" class="ph-bold ph-caret-down transition-transform duration-200"></i>
                            </div>
                        </button>

                        <div id="colorOptionsList" class="hidden absolute bottom-full mb-2 left-0 right-0 bg-white dark:bg-gray-900 rounded-xl shadow-xl border border-gray-100 dark:border-gray-700 z-50 overflow-hidden transition-all animate-fade-in-up">
                            <ul class="max-h-60 overflow-y-auto py-1">
                                <li onclick="selectColor('silver', 'Prata', 'bg-gray-400')" class="cursor-pointer px-4 py-2.5 hover:bg-gray-100 dark:hover:bg-gray-800 flex items-center gap-3 transition-colors">
                                    <span class="w-4 h-4 rounded-md bg-gray-400 shadow-sm border border-gray-200"></span>
                                    <span class="text-xs font-bold text-gray-700 dark:text-gray-200">Prata</span>
                                </li>
                                <li onclick="selectColor('black', 'Preto', 'bg-black')" class="cursor-pointer px-4 py-2.5 hover:bg-gray-100 dark:hover:bg-gray-800 flex items-center gap-3 transition-colors">
                                    <span class="w-4 h-4 rounded-md bg-black shadow-sm"></span>
                                    <span class="text-xs font-bold text-gray-700 dark:text-gray-200">Preto</span>
                                </li>
                                <li onclick="selectColor('white', 'Branco', 'bg-white')" class="cursor-pointer px-4 py-2.5 hover:bg-gray-100 dark:hover:bg-gray-800 flex items-center gap-3 transition-colors">
                                    <span class="w-4 h-4 rounded-md bg-white border border-gray-300 shadow-sm"></span>
                                    <span class="text-xs font-bold text-gray-700 dark:text-gray-200">Branco</span>
                                </li>
                                <li onclick="selectColor('gray', 'Cinza', 'bg-gray-600')" class="cursor-pointer px-4 py-2.5 hover:bg-gray-100 dark:hover:bg-gray-800 flex items-center gap-3 transition-colors">
                                    <span class="w-4 h-4 rounded-md bg-gray-600 shadow-sm"></span>
                                    <span class="text-xs font-bold text-gray-700 dark:text-gray-200">Cinza</span>
                                </li>
                                <li onclick="selectColor('red', 'Vermelho', 'bg-red-600')" class="cursor-pointer px-4 py-2.5 hover:bg-gray-100 dark:hover:bg-gray-800 flex items-center gap-3 transition-colors">
                                    <span class="w-4 h-4 rounded-md bg-red-600 shadow-sm"></span>
                                    <span class="text-xs font-bold text-gray-700 dark:text-gray-200">Vermelho</span>
                                </li>
                                <li onclick="selectColor('blue', 'Azul', 'bg-blue-700')" class="cursor-pointer px-4 py-2.5 hover:bg-gray-100 dark:hover:bg-gray-800 flex items-center gap-3 transition-colors">
                                    <span class="w-4 h-4 rounded-md bg-blue-700 shadow-sm"></span>
                                    <span class="text-xs font-bold text-gray-700 dark:text-gray-200">Azul</span>
                                </li>
                                <li onclick="selectColor('green', 'Verde', 'bg-green-900')" class="cursor-pointer px-4 py-2.5 hover:bg-gray-100 dark:hover:bg-gray-800 flex items-center gap-3 transition-colors">
                                    <span class="w-4 h-4 rounded-md bg-green-900 shadow-sm"></span>
                                    <span class="text-xs font-bold text-gray-700 dark:text-gray-200">Verde</span>
                                </li>
                                <li onclick="selectColor('brown', 'Marrom', 'bg-[#3d3126]')" class="cursor-pointer px-4 py-2.5 hover:bg-gray-100 dark:hover:bg-gray-800 flex items-center gap-3 transition-colors">
                                    <span class="w-4 h-4 rounded-md bg-[#3d3126] shadow-sm"></span>
                                    <span class="text-xs font-bold text-gray-700 dark:text-gray-200">Marrom</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <hr class="border-gray-100 dark:border-gray-800 w-full">

                <div class="flex flex-col md:flex-row items-center justify-between gap-4">
                    
                    <div class="flex flex-col w-full md:w-auto gap-1.5">
    
                        <span class="text-[10px] font-extrabold text-moss dark:text-green-400 uppercase tracking-widest ml-1 flex items-center gap-1">
                            <i class="ph-bold ph-crosshair"></i>
                            1. Selecione a Área
                        </span>

                        <div class="bg-gray-100 dark:bg-gray-800 p-1.5 rounded-xl flex gap-1 w-full shadow-inner border border-gray-200 dark:border-gray-700">
                            
                            <button onclick="setTargetZone('sides')" id="tab-sides" class="group flex-1 md:flex-none px-6 py-2.5 rounded-lg text-xs font-bold uppercase tracking-wide transition-all duration-300 flex items-center justify-center gap-2 bg-white dark:bg-gray-700 text-moss dark:text-white shadow-sm ring-1 ring-black/5">
                                <i class="ph-fill ph-car-profile text-lg"></i>
                                Laterais
                            </button>

                            <button onclick="setTargetZone('front')" id="tab-front" class="group flex-1 md:flex-none px-6 py-2.5 rounded-lg text-xs font-bold uppercase tracking-wide transition-all duration-300 flex items-center justify-center gap-2 text-gray-400 dark:text-gray-500 hover:text-black dark:hover:text-white hover:bg-white/50">
                                <i class="ph-bold ph-wind"></i> Parabrisa
                            </button>

                        </div>
                    </div>

                    <div class="w-full md:flex-1 overflow-hidden">
                        <div class="flex items-center justify-between px-1 mb-2 md:hidden">
                            <span class="text-[10px] font-bold text-gray-400 uppercase tracking-widest" id="zone-title">Visualizando: Laterais</span>
                            <span id="film-label" class="text-[10px] font-bold text-moss uppercase tracking-widest">G20</span>
                        </div>
                        
                        <div class="flex gap-3 overflow-x-auto no-scrollbar py-1 px-1 snap-x" id="tints-container">
                            </div>
                    </div>
                </div>

                
            </div>
        </footer>
    </section>

    <section class="relative z-50 bg-white dark:bg-[#111111] py-20 px-6 md:px-20 transition-colors duration-500">
        <div class="max-w-4xl mx-auto">
            <h2 class="text-3xl font-bold mb-8 text-center text-moss dark:text-white">Nossas Marcas Exclusivas</h2>
            
            <div class="mb-16 grid md:grid-cols-2 gap-8 items-center">
                <div class="order-2 md:order-1">
                    <h3 class="text-2xl font-bold mb-4 dark:text-white">BlueTech</h3>
                    <p class="text-gray-600 dark:text-gray-400 mb-4 leading-relaxed">
                        A escolha inteligente para quem busca performance e estética. A linha BlueTech oferece excelente custo-benefício com duas variações principais:
                    </p>
                    <ul class="space-y-3">
                        <li class="flex items-start gap-2">
                            <i class="ph-fill ph-shield-check text-moss mt-1"></i>
                            <div>
                                <strong class="block text-black dark:text-gray-200">Carbono (Média Retenção)</strong>
                                <span class="text-sm text-gray-500">Estabilidade de cor e ótima privacidade. Ideal para o dia a dia.</span>
                            </div>
                        </li>
                        <li class="flex items-start gap-2">
                            <i class="ph-fill ph-star text-moss mt-1"></i>
                            <div>
                                <strong class="block text-black dark:text-gray-200">Cerâmico (Alta Retenção)</strong>
                                <span class="text-sm text-gray-500">Tecnologia WindowBlue. Maior rejeição de calor e clareza óptica superior.</span>
                            </div>
                        </li>
                    </ul>
                </div>
                <div class="order-1 md:order-2 h-64 rounded-2xl overflow-hidden shadow-lg group">
                <img src="imgs/bluetech.png" 
                        alt="Película BlueTech" 
                        class="w-full h-full object-cover transform group-hover:scale-105 transition-transform duration-700">
                </div>
            </div>

            <hr class="border-gray-200 dark:border-gray-800 mb-16">

            <div class="grid md:grid-cols-2 gap-8 items-center">
                <div class="h-64 rounded-2xl overflow-hidden shadow-lg group">
                    <img src="imgs/garware.png" 
                        alt="Película Garware" 
                        class="w-full object-cover transform group-hover:scale-105 mt-9 duration-700">
                </div>
                <div>
                    <h3 class="text-2xl font-bold mb-4 dark:text-white">Garware</h3>
                    <p class="text-gray-600 dark:text-gray-400 mb-4 leading-relaxed">
                        Líder global em películas de alta performance. Durabilidade extrema e tecnologia de ponta para os clientes mais exigentes.
                    </p>
                    <ul class="space-y-3">
                        <li class="flex items-start gap-2">
                            <i class="ph-fill ph-fire text-moss mt-1"></i>
                            <div>
                                <strong class="block text-black dark:text-gray-200">Linha HP (High Performance)</strong>
                                <span class="text-sm text-gray-500">Estrutura metalizada híbrida, oferecendo durabilidade e alta rejeição de calor.</span>
                            </div>
                        </li>
                        <li class="flex items-start gap-2">
                            <i class="ph-fill ph-diamond text-moss mt-1"></i>
                            <div>
                                <strong class="block text-black dark:text-gray-200">Linha IR Plus (Infrared)</strong>
                                <span class="text-sm text-gray-500">O topo de linha. Tecnologia de nano-cerâmica que bloqueia quase todo o infravermelho sem escurecer a visão interna.</span>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </section>

    <div id="budget-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 bg-black/70 backdrop-blur-sm transition-opacity" onclick="closeModal()"></div>
        
        <div class="relative bg-white dark:bg-gray-900 w-full max-w-lg rounded-3xl shadow-2xl overflow-hidden flex flex-col h-[90vh] max-h-[800px] animate-fade-in-up">
        
            <div class="flex items-center justify-between p-5 border-b border-gray-100 dark:border-gray-800 bg-white dark:bg-gray-900 z-20 shrink-0">
                <div>
                    <h3 class="text-lg font-bold text-black dark:text-white">Orçamento Rápido</h3>
                    <p class="text-xs text-gray-500">Personalize seu pacote</p>
                </div>
                <button onclick="closeModal()" class="w-9 h-9 rounded-full bg-gray-100 dark:bg-gray-800 text-gray-500 dark:text-gray-400 flex items-center justify-center hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                    <i class="ph-bold ph-x text-lg"></i>
                </button>
            </div>

            <div class="flex-1 overflow-hidden relative bg-white dark:bg-gray-900">
                
                <div id="step-1" class="h-full flex flex-col">
                    
                    <div class="px-6 pt-6 pb-2 shrink-0 z-10 bg-white dark:bg-gray-900">
                        <div class="text-center">
                            <span class="text-xs font-bold text-moss uppercase tracking-widest bg-green-50 dark:bg-green-900/30 px-3 py-1 rounded-full">Passo 1 de 3</span>
                            <h3 class="text-2xl font-black mt-4 leading-tight text-black dark:text-white">
                                Configuração dos<br>Vidros Laterais e Traseiro
                            </h3>
                            <p class="text-sm text-gray-500 mt-2">Escolha a tecnologia ideal para o seu carro.</p>
                        </div>
                    </div>

                    <div class="flex-1 overflow-y-auto p-6 scroll-smooth">
                        <div id="options-sides" class="space-y-6"></div>
                    </div>

                    <div class="p-6 pt-4 bg-white dark:bg-gray-900 border-t border-gray-100 dark:border-gray-800 shrink-0 z-10">
                        <button onclick="nextStep()" class="w-full bg-moss text-white py-4 rounded-xl font-bold text-lg shadow-lg hover:bg-mossDark active:scale-95 transition-all flex items-center justify-center gap-2">
                            Continuar
                            <i class="ph-bold ph-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <div id="step-2" class="hidden h-full flex flex-col">
                    
                    <div class="px-6 pt-6 pb-2 shrink-0 z-10 bg-white dark:bg-gray-900">
                        <button onclick="changeStep(1)" class="mb-2 text-sm text-gray-400 hover:text-black dark:hover:text-white flex items-center gap-1 font-bold">
                            <i class="ph-bold ph-arrow-left"></i> Voltar
                        </button>
                        <div class="text-center">
                            <span class="text-xs font-bold text-moss uppercase tracking-widest bg-green-50 dark:bg-green-900/30 px-3 py-1 rounded-full">Passo 2 de 3</span>
                            <h3 class="text-2xl font-black mt-4 leading-tight text-black dark:text-white">
                                Película para o<br>Para-brisa (Frente)
                            </h3>
                            <p class="text-sm text-gray-500 mt-2">Maior conforto térmico e visibilidade.</p>
                        </div>
                    </div>

                    <div class="flex-1 overflow-y-auto p-6 scroll-smooth">
                        <div id="options-front" class="space-y-6"></div>
                    </div>

                    <div class="p-6 pt-4 bg-white dark:bg-gray-900 border-t border-gray-100 dark:border-gray-800 shrink-0 z-10">
                        <button onclick="nextStep()" class="w-full bg-moss text-white py-4 rounded-xl font-bold text-lg shadow-lg hover:bg-mossDark active:scale-95 transition-all flex items-center justify-center gap-2">
                            Ver Resumo e Preço
                            <i class="ph-bold ph-receipt"></i>
                        </button>
                    </div>
                </div>

                <div id="step-3" class="hidden h-full flex flex-col">
                    
                    <div class="px-6 pt-6 pb-2 shrink-0 z-10 bg-white dark:bg-gray-900">
                        <button onclick="changeStep(2)" class="mb-4 text-sm text-gray-400 hover:text-black dark:hover:text-white flex items-center gap-1 font-bold">
                            <i class="ph-bold ph-arrow-left"></i> Voltar
                        </button>
                        <div class="text-center">
                            <h3 class="text-2xl font-black text-black dark:text-white">Resumo do Pedido</h3>
                            <p class="text-sm text-gray-500">Confira se está tudo certo.</p>
                        </div>
                    </div>

                    <div class="flex-1 overflow-y-auto p-6 scroll-smooth">
                        <div class="bg-gray-50 dark:bg-gray-800 p-6 rounded-2xl border border-gray-100 dark:border-gray-700">
                            <div class="flex justify-between items-start mb-4 pb-4 border-b border-gray-200 dark:border-gray-700">
                                <div>
                                    <span class="text-xs font-bold text-gray-400 uppercase">Laterais e Traseiro</span>
                                    <p class="font-bold text-black dark:text-white text-lg leading-tight" id="summary-sides-name">Modelo</p>
                                    <span class="text-xs text-moss font-bold" id="summary-sides-brand">Marca</span>
                                </div>
                                <span class="font-bold text-lg text-gray-700 dark:text-gray-300" id="summary-sides-price">R$ 0</span>
                            </div>

                            <div class="flex justify-between items-start mb-4 pb-4 border-b border-gray-200 dark:border-gray-700">
                                <div>
                                    <span class="text-xs font-bold text-gray-400 uppercase">Para-brisa</span>
                                    <p class="font-bold text-black dark:text-white text-lg leading-tight" id="summary-front-name">Modelo</p>
                                    <span class="text-xs text-moss font-bold" id="summary-front-brand">Marca</span>
                                </div>
                                <span class="font-bold text-lg text-gray-700 dark:text-gray-300" id="summary-front-price">R$ 0</span>
                            </div>

                            <div class="flex justify-between items-end pt-2">
                                <div class="flex flex-col">
                                    <span class="text-xs text-gray-400 line-through decoration-red-400" id="summary-raw-total">R$ 000</span>
                                    <span class="text-xs font-bold text-green-600 bg-green-100 px-2 py-0.5 rounded-md w-fit">5% de Desconto Web (À Vista)</span>
                                </div>
                                <div class="text-right">
                                    <span class="text-xs text-gray-500 block mb-0.5">Total Final</span>
                                    <span class="text-3xl font-black text-moss" id="summary-final-total">R$ 000</span>
                                </div>
                            </div>
                        </div>

                        <div class="mt-4 mb-6 flex gap-2 items-start bg-yellow-50 dark:bg-yellow-900/20 p-3 rounded-xl border border-yellow-100 dark:border-yellow-800/30">
                            <i class="ph-fill ph-warning text-yellow-600 dark:text-yellow-400 mt-0.5 text-lg shrink-0"></i>
                            <p class="text-[11px] leading-snug text-yellow-800 dark:text-yellow-200">
                                <strong>Importante:</strong> O valor pode variar de acordo com a quantidade de vidros no carro.
                            </p>
                        </div>

                        <div class="space-y-4 mb-2">
                            <div>
                                <label class="block text-xs font-bold text-gray-500 mb-1 ml-1">SEU NOME</label>
                                <input type="text" id="client-name" class="w-full bg-gray-100 dark:bg-gray-800 border-2 border-transparent focus:border-moss focus:bg-white dark:focus:bg-black rounded-xl px-4 py-3.5 text-base outline-none transition-all dark:text-white font-bold" placeholder="Digite seu nome...">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-gray-500 mb-1 ml-1">E-MAIL (Opcional)</label>
                                <input type="email" id="client-email" class="w-full bg-gray-100 dark:bg-gray-800 border-2 border-transparent focus:border-moss focus:bg-white dark:focus:bg-black rounded-xl px-4 py-3.5 text-base outline-none transition-all dark:text-white" placeholder="seunome@email.com">
                            </div>
                        </div>
                    </div>

                    <div class="p-6 pt-4 bg-white dark:bg-gray-900 border-t border-gray-100 dark:border-gray-800 shrink-0 z-10">
                        <button onclick="sendToWhatsapp()" class="w-full bg-[#25D366] text-white py-4 rounded-xl font-bold text-lg shadow-lg hover:scale-[1.02] active:scale-95 transition-all flex items-center justify-center gap-2">
                            <i class="ph-fill ph-whatsapp-logo text-2xl"></i>
                            Enviar Pedido no WhatsApp
                        </button>
                        <p class="text-[10px] text-center text-gray-400 mt-3">Ao clicar, você será redirecionado para nosso atendimento.</p>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        // ================= LÓGICA DO DROPDOWN (CORES + MODELOS) =================
        
        // 1. Dropdown de CORES
        function toggleColorDropdown() {
            const list = document.getElementById('colorOptionsList');
            const arrow = document.getElementById('colorArrow');
            
            // Fecha o outro se estiver aberto
            document.getElementById('modelOptionsList').classList.add('hidden');
            document.getElementById('modelArrow').classList.remove('rotate-180');

            list.classList.toggle('hidden');
            if (list.classList.contains('hidden')) {
                arrow.classList.remove('rotate-180');
            } else {
                arrow.classList.add('rotate-180');
            }
        }

        function selectColor(value, name, bgClass) {
            // Atualiza o texto e a bolinha do botão principal
            document.getElementById('displayColorText').innerHTML = `
                <span class="w-3 h-3 rounded ${bgClass} border border-gray-300 shadow-sm"></span>
                ${name}
            `;
            
            // Atualiza o input escondido
            document.getElementById('selectedColorValue').value = value;
            
            // Chama a função do modelo 3D
            if (typeof setCarColor === 'function') {
                setCarColor(value);
            }
            
            // Fecha o dropdown
            toggleColorDropdown();
        }

        // 2. Dropdown de MODELOS (Novo)
        function toggleModelDropdown() {
            const list = document.getElementById('modelOptionsList');
            const arrow = document.getElementById('modelArrow');

            // Fecha o outro se estiver aberto
            document.getElementById('colorOptionsList').classList.add('hidden');
            document.getElementById('colorArrow').classList.remove('rotate-180');

            list.classList.toggle('hidden');
            if (list.classList.contains('hidden')) {
                arrow.classList.remove('rotate-180');
            } else {
                arrow.classList.add('rotate-180');
            }
        }

        function selectModel(value, name) {
            document.getElementById('displayModelText').innerText = name;
            if (typeof setCarModel === 'function') setCarModel(value);
            toggleModelDropdown();
        }

        // Fecha os dropdowns se clicar fora
        window.addEventListener('click', function(e) {
            const colorContainer = document.getElementById('color-dropdown-container');
            const modelContainer = document.getElementById('model-dropdown-container');
            
            if (!colorContainer.contains(e.target)) {
                document.getElementById('colorOptionsList').classList.add('hidden');
                document.getElementById('colorArrow').classList.remove('rotate-180');
            }
            if (!modelContainer.contains(e.target)) {
                document.getElementById('modelOptionsList').classList.add('hidden');
                document.getElementById('modelArrow').classList.remove('rotate-180');
            }
        });


        // ================= DADOS DOS MODELOS 3D =================
        const carModels = {
        sport: {
            name: 'Esportivo',
            src: 'models/911.glb',
            camera: '45deg 75deg 145%'
        },
        suv: {
            name: 'SUV',
            src: 'models/Jaecoo.glb',
            camera: '35deg 75deg 155%'
        },
        hatch: {
            name: 'Hatch',
            src: 'models/Golf.glb',
            camera: '45deg 70deg 150%'
        },
        sedan: {
            name: 'Sedã',
            src: 'models/Sentra.glb',
            camera: '40deg 75deg 150%'
        },
        pickup: {
            name: 'Caminhonete',
            src: 'models/Frontier.glb',
            camera: '30deg 70deg 165%'
        },
        classic: {
            name: 'Antigo',
            src: 'models/Fusca.glb',
            camera: '50deg 75deg 140%'
        }
        };

        // Cores dos carros

        const carColors = {
            black:  { name: 'Preto Sapphire',    color: '#080808' }, // Quase preto, mas permite reflexo
            white:  { name: 'Branco Alpino',     color: '#e8e8e8' }, // Branco levemente cinza para não "estourar" na luz
            silver: { name: 'Prata Glaciar',     color: '#c4c4c4' }, // Prata metálico clássico
            gray:   { name: 'Cinza Mineral',     color: '#444444' }, // Chumbo escuro (Gunmetal)
            red:    { name: 'Vermelho Melbourne',color: '#690f0f' }, // Vermelho sangue profundo, menos "brinquedo"
            blue:   { name: 'Azul Phytonic',     color: '#0f1f3d' }, // Azul marinho noturno elegante
            green:  { name: 'Verde Oxford',      color: '#0d2612' }, // Verde inglês bem fechado
            brown:  { name: 'Bronze Dravit',     color: '#3d3126' }  // Marrom bronzeado sofisticado
        };

        // ================= LÓGICA DO TOAST =================

        // Função para fechar o toast (manual ou automática)
        function closeToast() {
            const toast = document.getElementById('promo-toast');
            toast.classList.add('-translate-y-[200%]');
        }

        // Função para abrir e iniciar o timer
        function showToast() {
            const toast = document.getElementById('promo-toast');
            const progressBar = document.getElementById('toast-progress');
            
            // 1. Mostra o toast (remove o translate que esconde)
            toast.classList.remove('-translate-y-[200%]');

            // 2. Anima a barra de progresso (espera 100ms para a transição funcionar)
            setTimeout(() => {
                progressBar.style.transition = 'width 5s linear'; // Define 5 segundos linear
                progressBar.style.width = '100%'; // Enche a barra
            }, 100);

            // 3. Fecha automaticamente após 5 segundos (5000ms)
            setTimeout(() => {
                closeToast();
            }, 5100); // 5100ms para dar tempo da barra chegar ao final
        }

        // Inicia tudo 1.5 segundos após o site carregar
        window.addEventListener('load', () => {
            setTimeout(showToast, 1500);
        });

        // Função auxiliar para formatar dinheiro (BRL)
        const formatMoney = (value) => {
            return value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        };

        // ================= DADOS DE PREÇOS =================
        const pricingData = {
            sides: [    
                
                { id: 'bt_carb', brand: 'BlueTech "Custo Benefício"', name: 'Carbono (Média Retenção)', price: 690, desc: 'Privacidade e Ótimo Custo.' },
                { id: 'bt_cer',  brand: 'BlueTech "Custo Benefício"', name: 'Cerâmica (Alta Retenção)', price: 890, desc: 'Tecnologia WindowBlue Térmica.' },
                { id: 'gw_hp',   brand: 'Garware "Premium"',  name: 'HP (Média Retenção)', price: 899, desc: 'Privacidade e Ótima Visibilidade.' },
                { id: 'gw_ic',   brand: 'Garware "Premium"',  name: 'Ice Cool (Alta Retenção G70)',         price: 1200, desc: 'Máxima Rejeição de Calor.' },
                { id: 'gw_ir',   brand: 'Garware "Premium"',  name: 'IR Plus (Alta Retenção)',   price: 1499, desc: 'Máxima Rejeição de Calor.' },
                { id: 'none',    brand: 'Original',        name: 'Sem Película',   price: 0,   desc: 'Vidro original transparente.' }
            ],
            front: [
                { id: 'bt_carb', brand: 'BlueTech "Custo Benefício"', name: 'Carbono (Média Retenção)',         price: 410, desc: 'Privacidade e Ótimo Custo.' },
                { id: 'bt_cer',  brand: 'BlueTech "Custo Benefício"', name: 'Cerâmica (Alta Retenção)',        price: 510, desc: 'Tecnologia WindowBlue Térmica.' },
                { id: 'gw_hp',   brand: 'Garware "Premium"',  name: 'HP (Média Retenção)',              price: 540, desc: 'Privacidade e Ótima Visibilidade.' },
                { id: 'gw_ic',   brand: 'Garware "Premium"',  name: 'Ice Cool (Alta Retenção G70)',         price: 750, desc: 'Máxima Rejeição de Calor.' },
                { id: 'gw_ir',   brand: 'Garware "Premium"',  name: 'IR Plus (Alta Retenção)',         price: 900, desc: 'Máxima Rejeição de Calor.' },
                { id: 'none',    brand: 'Original', name: 'Sem Película',    price: 0,   desc: 'Manter vidro original transparente.'}
            ]
        };

        // Estado Inicial
        let budgetState = {
            step: 1,
            sides: pricingData.sides[0], // Padrão
            front: pricingData.front[0]  // Padrão
        };

        // Função auxiliar para calcular as listas válidas baseadas no 3D
        function getFilteredLists() {
            const sideTint = state.currentTints.sides;
            const frontTint = state.currentTints.front;

            // --- FILTRO LATERAIS ---
            const filteredSides = pricingData.sides.filter(item => {
                // Se NÃO for G70 -> Remove Ice Cool
                if (sideTint !== 'g70' && item.id === 'gw_ic') return false;
                // Se FOR G70 -> Remove HP e IR Plus
                if (sideTint === 'g70' && (item.id === 'gw_hp' || item.id === 'gw_ir')) return false;
                return true;
            });

            // --- FILTRO PARABRISA ---
            const filteredFront = pricingData.front.filter(item => {
                // Se NÃO for G70 -> Remove Ice Cool
                if (frontTint !== 'g70' && item.id === 'gw_ic') return false;
                // Se FOR G70 -> Remove HP e IR Plus
                if (frontTint === 'g70' && (item.id === 'gw_hp' || item.id === 'gw_ir')) return false;
                return true;
            });

            return { filteredSides, filteredFront };
        }
        // ================= LÓGICA DO MODAL =================

        function openModal() {
            document.getElementById('budget-modal').classList.remove('hidden');
            
            // 1. Pega as listas já filtradas
            const { filteredSides, filteredFront } = getFilteredLists();

            // 2. FORÇA a seleção a ser o primeiro item da lista disponível
            if (filteredSides.length > 0) budgetState.sides = filteredSides[0];
            if (filteredFront.length > 0) budgetState.front = filteredFront[0];

            // 3. Renderiza
            renderBudgetOptions();
            updateSummary();
        }

        function closeModal() {
            document.getElementById('budget-modal').classList.add('hidden');
            budgetState.step = 1;
            changeStep(1); // Reseta para o passo 1
        }

        // Função principal que desenha os botões agrupados
        function renderBudgetOptions() {
            // 1. Pega as listas filtradas (usando a mesma lógica do openModal)
            const { filteredSides, filteredFront } = getFilteredLists();

            // 2. Renderiza Passo 1: Laterais
            const sidesContainer = document.getElementById('options-sides');
            sidesContainer.innerHTML = createGroupedHTML(filteredSides, 'sides');

            // 3. Renderiza Passo 2: Parabrisa
            const frontContainer = document.getElementById('options-front');
            frontContainer.innerHTML = createGroupedHTML(filteredFront, 'front');
        }

        // Função auxiliar para agrupar por marca e gerar HTML
        function createGroupedHTML(items, type) {
            // 1. Agrupa os itens por marca
            const groups = {};
            items.forEach(item => {
                if (!groups[item.brand]) groups[item.brand] = [];
                groups[item.brand].push(item);
            });

            // 2. Gera o HTML de cada grupo
            let html = '';
            
            // Ordem de exibição das marcas (para ficar organizado)
            const brandOrder = ['BlueTech', 'Garware', 'Original'];
            
            // Ordena as chaves do objeto groups baseado na lista brandOrder
            const sortedBrands = Object.keys(groups).sort((a, b) => {
                return brandOrder.indexOf(a) - brandOrder.indexOf(b);
            });

            sortedBrands.forEach(brand => {
                // Título da Marca
                html += `
                    <div>
                        <h5 class="text-xs font-black text-gray-400 uppercase tracking-widest mb-3 ml-1 border-b border-gray-100 dark:border-gray-800 pb-1">
                            ${brand === 'Original' ? 'Opção Padrão' : 'Marca: ' + brand}
                        </h5>
                        <div class="space-y-3">
                `;

                // Cartões de opções dentro dessa marca
                groups[brand].forEach(opt => {
                    const isSelected = budgetState[type].id === opt.id;
                    const activeClass = isSelected ? 'border-moss bg-moss/5 ring-1 ring-moss' : 'border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600';
                    const checkIcon = isSelected ? '<i class="ph-fill ph-check-circle text-moss text-2xl animate-bounce"></i>' : '<div class="w-6 h-6 rounded-full border-2 border-gray-200 dark:border-gray-700"></div>';

                    html += `
                        <div onclick="selectBudgetOption('${type}', '${opt.id}')" 
                             class="cursor-pointer relative p-4 rounded-xl border-2 transition-all duration-200 flex items-center justify-between group ${activeClass}">
                            
                            <div class="flex flex-col">
                                <span class="font-bold text-black dark:text-white text-base">${opt.name}</span>
                                <span class="text-xs text-gray-500 mt-0.5">${opt.desc}</span>
                            </div>

                            <div class="flex items-center gap-4">
                                <span class="font-bold text-moss text-lg whitespace-nowrap">${opt.price === 0 ? 'Grátis' : 'R$ ' + opt.price}</span>
                                ${checkIcon}
                            </div>

                        </div>
                    `;
                });

                html += `</div></div>`; // Fecha container do grupo
            });

            return html;
        }

        function selectBudgetOption(type, id) {
            // Precisamos buscar na lista COMPLETA, não na filtrada, para garantir que o objeto existe
            const list = type === 'sides' ? pricingData.sides : pricingData.front;
            const selectedItem = list.find(item => item.id === id);
            
            if (selectedItem) {
                budgetState[type] = selectedItem;
                // Re-renderiza para atualizar a borda verde e o check
                renderBudgetOptions();
            }
        }

        function nextStep() {
            if(budgetState.step < 3) {
                changeStep(budgetState.step + 1);
            }
        }

        function changeStep(step) {
            budgetState.step = step;
            
            // Esconde todos
            document.getElementById('step-1').classList.add('hidden');
            document.getElementById('step-2').classList.add('hidden');
            document.getElementById('step-3').classList.add('hidden');
            
            // Mostra o atual com animação
            const currentDiv = document.getElementById(`step-${step}`);
            currentDiv.classList.remove('hidden');
            currentDiv.classList.add('modal-animate');

            if (step === 3) {
                updateSummary();
            }
        }

        function updateSummary() {
            const rawTotal = budgetState.sides.price + budgetState.front.price;
            const discount = rawTotal * 0.05;
            const finalTotal = rawTotal - discount;
            const format = (v) => v.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });

            // Atualiza Textos
            document.getElementById('summary-sides-name').innerText = budgetState.sides.name;
            document.getElementById('summary-sides-brand').innerText = budgetState.sides.brand;
            document.getElementById('summary-sides-price').innerText = format(budgetState.sides.price);

            document.getElementById('summary-front-name').innerText = budgetState.front.name;
            document.getElementById('summary-front-brand').innerText = budgetState.front.brand;
            document.getElementById('summary-front-price').innerText = budgetState.front.price === 0 ? 'Incluso' : format(budgetState.front.price);

            document.getElementById('summary-raw-total').innerText = format(rawTotal);
            document.getElementById('summary-final-total').innerText = format(finalTotal);
        }

        function sendToWhatsapp() {
            const name = document.getElementById('client-name').value;
            const email = document.getElementById('client-email').value;

            if(!name) { 
                alert('Por favor, digite seu nome para finalizar.'); 
                document.getElementById('client-name').focus();
                return; 
            }

            const rawTotal = budgetState.sides.price + budgetState.front.price;
            const discount = rawTotal * 0.05;
            const finalTotal = rawTotal - discount;
            const format = (v) => v.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });

            // Pegar o nome da tonalidade (G5, G20 etc) selecionada no 3D
            const sideTintCode = state.currentTints.sides;
            const frontTintCode = state.currentTints.front;
            
            // Busca o nome legível no objeto tintData (ex: "G5")
            const sideTintName = tintData[sideTintCode] ? tintData[sideTintCode].name : '';
            const frontTintName = tintData[frontTintCode] ? tintData[frontTintCode].name : '';

            // Só adiciona o nome da tonalidade se não for "Sem Película"
            const sideDisplay = budgetState.sides.id !== 'none' ? ` (${sideTintName})` : '';
            const frontDisplay = budgetState.front.id !== 'none' ? ` (${frontTintName})` : '';

            const phone = "5532999734079"; 

            const text = `*NOVO PEDIDO PELO SITE (5% OFF)*\n` +
                         `*Cliente:* ${name}\n` +
                         `*Email:* ${email || 'Não informado'}\n\n` +
                         `*PRODUTOS ESCOLHIDOS:*\n` +
                         `*Laterais/Traseira:*\n` +
                         `   Marca: ${budgetState.sides.brand}\n` +
                         `   Linha: ${budgetState.sides.name}${sideDisplay}\n` +
                         `   Valor: ${format(budgetState.sides.price)}\n\n` +
                         `*Para-brisa:*\n` +
                         `   Marca: ${budgetState.front.brand}\n` +
                         `   Linha: ${budgetState.front.name}${frontDisplay}\n` +
                         `   Valor: ${budgetState.front.price === 0 ? 'Grátis/Original' : format(budgetState.front.price)}\n\n` +
                         `----------------------------\n` +
                         `Subtotal: ${format(rawTotal)}\n` +
                         `*TOTAL COM DESCONTO: ${format(finalTotal)}*`;

            window.open(`https://wa.me/${phone}?text=${encodeURIComponent(text)}`, '_blank');
            closeModal();
        }

        // ================= CONFIGURAÇÃO DE MATERIAIS 3D =================
        const materialNames = {
            front: 'glass_front',
            sides: 'glass_side', 
            ignore: 'glass_back' 
        };

        const tintData = {
            'clear': { opacity: 0.1, color: '#ffffff', roughness: 0.1, name: 'Original' },
            'g70':   { opacity: 0.18, color: '#444444', roughness: 0.1, name: 'G70' },
            'g35':   { opacity: 0.85, color: '#2a2a2a', roughness: 0.05, name: 'G35' },
            'g20':   { opacity: 0.94, color: '#111111', roughness: 0.02, name: 'G20' },
            'g5':    { opacity: 0.98, color: '#000000', roughness: 0.01, name: 'G5' },
        };

        let state = {
            activeZone: 'sides',
            currentTints: { sides: 'clear', front: 'clear' },
            isNight: false,
            currentCar: 'suv',
            currentColor: 'silver'
        };

        const viewer = document.getElementById('car-viewer');

        // ================= FUNÇÕES DE CONTROLE DO VISUALIZADOR =================
        function setCarModel(carKey) {
        const car = carModels[carKey];
        if (!car) return;

        toggleLoader(true);

        state.currentCar = carKey;
        viewer.src = car.src;
        viewer.cameraOrbit = car.camera;

        viewer.addEventListener('load', () => {
            applyTintToModel();
            applyCarColor();
            toggleLoader(false);
        }, { once: true });
        }

        // ================= FUNÇÕES DE COR DO CARRO =================
        function applyCarColor() {
        if (!viewer.model) return;

        const selected = carColors[state.currentColor];
        if (!selected) return;

        const hex = selected.color.replace('#','');
        const rgb = [
            parseInt(hex.substring(0,2),16)/255,
            parseInt(hex.substring(2,4),16)/255,
            parseInt(hex.substring(4,6),16)/255
        ];

        viewer.model.materials.forEach(mat => {
            if (mat.name.toLowerCase().includes('paint_color')) {
            mat.pbrMetallicRoughness.setBaseColorFactor([...rgb, 1]);
            mat.pbrMetallicRoughness.setMetallicFactor(0.6);
            mat.pbrMetallicRoughness.setRoughnessFactor(0.35);
            }
        });
        }

        function setCarColor(colorKey) {
        state.currentColor = colorKey;
        applyCarColor();
        }

        // ================= FUNÇÕES DE ZONA (VISUALIZADOR) =================

        function setTargetZone(zone) {
            state.activeZone = zone;
            
            const btnSides = document.getElementById('tab-sides');
            const btnFront = document.getElementById('tab-front');
            
            // Classes do botão ATIVO (Branco com texto Verde e Sombra)
            const activeClass = "bg-white dark:bg-gray-700 text-moss dark:text-white shadow-sm ring-1 ring-black/5 scale-100";
            // Classes do botão INATIVO (Cinza transparente)
            const inactiveClass = "text-gray-400 dark:text-gray-500 hover:text-black dark:hover:text-white hover:bg-white/50 scale-95 opacity-70 hover:opacity-100";

            // Ícones (Opcional: Trocar preenchimento do ícone)
            const iconSides = btnSides.querySelector('i');
            const iconFront = btnFront.querySelector('i');

            if (zone === 'sides') {
                // Ativa Sides
                btnSides.className = `group flex-1 md:flex-none px-6 py-2.5 rounded-lg text-xs font-bold uppercase tracking-wide transition-all duration-300 flex items-center justify-center gap-2 ${activeClass}`;
                iconSides.classList.replace('ph-bold', 'ph-fill'); // Ícone cheio
                
                // Desativa Front
                btnFront.className = `group flex-1 md:flex-none px-6 py-2.5 rounded-lg text-xs font-bold uppercase tracking-wide transition-all duration-300 flex items-center justify-center gap-2 ${inactiveClass}`;
                iconFront.classList.replace('ph-fill', 'ph-bold'); // Ícone contorno

                document.getElementById('zone-title').innerText = "Visualizando: Laterais & Traseira";
            } else {
                // Desativa Sides
                btnSides.className = `group flex-1 md:flex-none px-6 py-2.5 rounded-lg text-xs font-bold uppercase tracking-wide transition-all duration-300 flex items-center justify-center gap-2 ${inactiveClass}`;
                iconSides.classList.replace('ph-fill', 'ph-bold');

                // Ativa Front
                btnFront.className = `group flex-1 md:flex-none px-6 py-2.5 rounded-lg text-xs font-bold uppercase tracking-wide transition-all duration-300 flex items-center justify-center gap-2 ${activeClass}`;
                iconFront.classList.replace('ph-bold', 'ph-fill');

                document.getElementById('zone-title').innerText = "Visualizando: Parabrisa";
            }

            updateTintButtonsUI();
            
            if(zone === 'front') {
                viewer.cameraOrbit = '0deg 75deg 145%'; 
            } else {
                viewer.cameraOrbit = '45deg 75deg 145%';
            }
        }

        function setTint(tintId) {
            state.currentTints[state.activeZone] = tintId;
            updateTintButtonsUI();
            applyTintToModel();
        }

        // ================= LÓGICA 3D =================

        function applyTintToModel() {
            if (!viewer.model) return;

            const getParams = (id) => {
                const d = tintData[id];
                let c = d.color.substring(1).split('');
                if(c.length===3) c= [c[0], c[0], c[1], c[1], c[2], c[2]];
                c= '0x'+c.join('');
                const rgb = [((c>>16)&255)/255, ((c>>8)&255)/255, (c&255)/255];
                return { rgb, ...d };
            };

            const sidesParams = getParams(state.currentTints.sides);
            const frontParams = getParams(state.currentTints.front);

            viewer.model.materials.forEach(mat => {
                const name = mat.name.toLowerCase();

                if (name.includes(materialNames.ignore)) return; 

                if (name.includes(materialNames.front)) {
                    applyMaterial(mat, frontParams);
                } 
                else if (name.includes(materialNames.sides)) {
                    applyMaterial(mat, sidesParams);
                }
            });
        }

        function applyMaterial(mat, p) {
            mat.pbrMetallicRoughness.setRoughnessFactor(p.roughness);
            mat.pbrMetallicRoughness.setMetallicFactor(0.95);
            mat.pbrMetallicRoughness.setBaseColorFactor([...p.rgb, p.opacity]);
            mat.setAlphaMode('BLEND');
            mat.setDoubleSided(true);
        }

        // ================= UI BUILDER (VISUALIZADOR) =================

        function renderTintButtons() {
            const container = document.getElementById('tints-container');
            container.innerHTML = '';

            Object.keys(tintData).forEach(key => {
                const t = tintData[key];
                const btn = document.createElement('button');
                btn.className = 'tint-btn snap-center flex-shrink-0 group cursor-pointer text-center min-w-[60px]';
                btn.onclick = () => setTint(key);
                btn.dataset.id = key;

                let innerContent = '', bgStyle = '';
                
                if (key === 'clear') {
                    innerContent = '<i class="ph ph-sun text-gray-400 text-lg"></i>';
                    bgStyle = 'bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600';
                } else {
                    if(key === 'g70') bgStyle = 'bg-[#aaaaaa] border-gray-300';
                    if(key === 'g35') bgStyle = 'bg-[#555555] border-gray-400';
                    if(key === 'g20') bgStyle = 'bg-[#222222] border-gray-500';
                    if(key === 'g5')  bgStyle = 'bg-[#000000] border-gray-600';
                }

                btn.innerHTML = `
                    <div class="tint-circle w-12 h-12 rounded-full border transition-all relative overflow-hidden mx-auto mb-2 shadow-sm flex items-center justify-center ${bgStyle}">
                        ${innerContent}
                    </div>
                    <span class="tint-text text-[9px] font-bold text-gray-400 uppercase group-hover:text-black dark:group-hover:text-white block">${t.name.split(' ')[0]}</span>
                `;
                container.appendChild(btn);
            });
        }

        function updateTintButtonsUI() {
            const currentId = state.currentTints[state.activeZone];
            document.getElementById('film-label').innerText = tintData[currentId].name;

            document.querySelectorAll('.tint-btn').forEach(btn => {
                const circle = btn.querySelector('.tint-circle');
                const text = btn.querySelector('.tint-text');
                const isSelected = btn.dataset.id === currentId;

                if (isSelected) {
                    circle.classList.add('ring-2', 'ring-moss', 'ring-offset-2', 'dark:ring-offset-gray-900', 'border-transparent');
                    circle.classList.remove('border-gray-300', 'border-gray-400', 'border-gray-500', 'border-gray-600');
                    text.classList.remove('text-gray-400');
                    text.classList.add('text-black', 'dark:text-white');
                } else {
                    circle.classList.remove('ring-2', 'ring-moss', 'ring-offset-2', 'dark:ring-offset-gray-900', 'border-transparent');
                    if(!circle.className.includes('border-')) circle.classList.add('border-gray-300');
                    text.classList.add('text-gray-400');
                    text.classList.remove('text-black', 'dark:text-white');
                }
            });
        }

        // ================= NIGHT MODE & LOADER REATIVO =================

        const loader = document.getElementById('loading-overlay');
        const nightBtn = document.getElementById('toggle-night');

        // Função auxiliar para mostrar/esconder loader
        function toggleLoader(show) {
            if (show) {
                loader.classList.remove('opacity-0');
            } else {
                setTimeout(() => {
                    loader.classList.add('opacity-0');
                }, 500);
            }
        }

        // 1. Lógica do Botão (Mostra o loader -> Troca o tema)
        nightBtn.addEventListener('click', () => {
            toggleLoader(true);

            setTimeout(() => {
                state.isNight = !state.isNight;
                const body = document.body;
                const icon = document.getElementById('night-icon');
                
                if (state.isNight) {
                    body.classList.add('dark');
                    icon.classList.replace('ph-moon', 'ph-sun');
                    viewer.environmentImage = 'env/night.hdr'; 
                    viewer.exposure = 0.7;
                } else {
                    body.classList.remove('dark');
                    icon.classList.replace('ph-sun', 'ph-moon');
                    viewer.environmentImage = 'env/studio.hdr';
                    viewer.exposure = 1;
                }
            }, 100);
        });

        // 2. Quando o 3D terminar de carregar (inicial)
        viewer.addEventListener('load', () => {
        applyTintToModel();
        applyCarColor();
        toggleLoader(false);
        });

        // 3. Quando a iluminação (Environment) terminar de trocar
        viewer.addEventListener('environment-change', () => {
            toggleLoader(false);
        });

        // Fallback de segurança
        setTimeout(() => toggleLoader(false), 8000);

        // Inicialização Final
        renderTintButtons();
        setTargetZone('sides');

    </script>
</body>
</html>